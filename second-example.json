{
"AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Create a RHEL EC2 instance with nano installed",
    "Metadata": {

    },
    "Parameters": {
      
      "InstanceType": {
          "Description": "EC2 Instance type",
          "Type": "String",
          "Default": "t2.micro",
          "AllowedValues":["t2.nano","t2.micro","t2.small"],
          "ConstraintDescription": "Must be a valid EC2 instance type"
      },
      
      "SSHKeyName": {
          "Description": "Keypair (PEM) to allow SSH into the instance",
          "Type": "AWS::EC2::KeyPair::KeyName"
      }
    
    },
    "Mappings": {

    },
    "Conditions": {

    },
    "Resources": {
      
      "MyRHELInstance": {
          "Type": "AWS::EC2::Instance",
          "Properties": {
              "KeyName": {
                "Ref": "SSHKeyName" 
              },
              "ImageId": "ami-7c1bfd1b",
              "SubnetId": "subnet-8e101ff5",
              "InstanceType": {
                "Ref": "InstanceType" 
              },
              "Tags": [
                  {
                    "Key": "Name",
                    "Value": "MyRHEL"
                  }
              ],
              "SecurityGroupIds": [
                  { "Fn::GetAtt" : [ "RHELInstanceSecurityGroup", "GroupId" ]}    
              ],
              "UserData": {
                  "Fn::Base64": {
                      "Fn::Join": [
                          "",
                          [
                            "#!/bin/bash\n",
                            "yum update -y\n",
                            "yum install nano -y\n",
                            "touch /etc/yum.repos.d/mongodb.repo\n",
                            "echo 'Cloudformation generated it' >> /home/ec2-user/sample.txt"
                          ]
                        ]
                    }
                }
            }
        },

        
        "RHELInstanceSecurityGroup" : {
          "Type" : "AWS::EC2::SecurityGroup",
          "Properties" : {
            "GroupDescription" : "Enable SSH port",
            "SecurityGroupIngress" : [  
              { "IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" : "0.0.0.0/0" }
            ],
            "VpcId" : "vpc-38d1c851",
            "Tags" :  [
                {
                "Key":"Name",
                "Value":"sg-SSH"
                } 
            ]
          }
        }
        
    },
    "Outputs": {

    }
}